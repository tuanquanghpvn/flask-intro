{% extends 'admin/layout/base.html' %}

{% block css %}
    <link rel="stylesheet" href="{{ url_for('static', filename='admin/plugins/select2/select2.min.css') }}">
{% endblock %}

{% block content %}
    <!-- Content Header (Page header) -->
    <section class="content-header">
        <h1>
            Post
            <small>Update</small>
        </h1>
        <ol class="breadcrumb">
            <li><a href="{{ url_for('admin.DashboardView:index') }}"><i class="fa fa-dashboard"></i> Home</a></li>
            <li><a href="{{ url_for('admin.PostListView:index') }}">Post</a></li>
            <li class="active">Create</li>
        </ol>
    </section>
    <!-- Main content -->
    <section class="content">
        <div class="row">
            <div class="col-md-12">
                <form action="" method="POST">
                    <div class="box box-danger">
                        <div class="box-header with-border">
                            <div class="pull-left">
                                <a class="btn btn-xs btn-warning"
                                   href="{{ url_for('admin.PostListView:index') }}">Back</a>
                            </div>
                        </div>
                        <!-- /.box-header -->
                        <div class="box-body">
                            {{ form.csrf_token }}

                            <div class="form-group {% if form.category_id.errors %} has-error {% endif %}">
                                <label>Category</label>
                                {{ form.category_id(class_="form-control select2", style="width: 100%;") }}
                                <span class="help-block">
                                    {% for error in form.category_id.errors %}
                                        <p>{{ error }}</p>
                                    {% endfor %}
                                </span>
                            </div>

                            <div class="form-group {% if form.name.errors %} has-error {% endif %}">
                                <label>Name:</label>
                                <input id="id_name" name="{{ form.name.name }}" type="text" class="form-control"
                                       value="{{ form.name.data if form.name.data != None else '' }}"
                                       placeholder="Enter name">
                                <span class="help-block">
                                    {% for error in form.name.errors %}
                                        <p>{{ error }}</p>
                                    {% endfor %}
                                </span>
                            </div>

                            <div class="form-group {% if form.slug.errors %} has-error {% endif %}">
                                <label>Slug:</label>
                                <input id="id_slug" name="{{ form.slug.name }}" type="text" class="form-control"
                                       value="{{ form.slug.data if form.slug.data != None else '' }}"
                                       placeholder="Enter slug">
                                <span class="help-block">
                                    {% for error in form.slug.errors %}
                                        <p>{{ error }}</p>
                                    {% endfor %}
                                </span>
                            </div>

                            <div class="form-group">
                                <label>Description:</label>
                                <textarea class="form-control" name="{{ form.description.name }}"
                                          placeholder="Enter description">{{ form.description.data if form.description.data != None else '' }}</textarea>
                            </div>

                            <div class="form-group">
                                <label>Content:</label>
                                <textarea id="editor1" class="form-control" name="{{ form.content.name }}"
                                          placeholder="Enter content">{{ form.content.data if form.content.data != None else '' }}</textarea>
                            </div>
                        </div>
                        <!-- /.box-body -->
                        <div class="box-footer">
                            <button type="submit" class="btn btn-primary pull-right">Save</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>

    </section>
    <!-- /.content -->
{% endblock %}

{% block js %}
    <script src="{{ url_for('static', filename='admin/plugins/select2/select2.full.min.js') }}"></script>
    <!-- CK Editor -->
    <script src="https://cdn.ckeditor.com/4.5.5/full/ckeditor.js"></script>

    <script type="text/javascript">
        $(".select2").select2();

        $("#id_name").keyup(function () {
            var str = $(this).val();
            str = str.toLowerCase();
            str = str.replace(/à|á|ạ|ả|ã|â|ầ|ấ|ậ|ẩ|ẫ|ă|ằ|ắ|ặ|ẳ|ẵ/g, "a");
            str = str.replace(/è|é|ẹ|ẻ|ẽ|ê|ề|ế|ệ|ể|ễ/g, "e");
            str = str.replace(/ì|í|ị|ỉ|ĩ/g, "i");
            str = str.replace(/ò|ó|ọ|ỏ|õ|ô|ồ|ố|ộ|ổ|ỗ|ơ|ờ|ớ|ợ|ở|ỡ/g, "o");
            str = str.replace(/ù|ú|ụ|ủ|ũ|ư|ừ|ứ|ự|ử|ữ/g, "u");
            str = str.replace(/ỳ|ý|ỵ|ỷ|ỹ/g, "y");
            str = str.replace(/đ/g, "d");
            str = str.replace(/!|@|\$|%|\^|\*|\(|\)|\+|\=|\&lt;|\&gt;|\?|\/|,|\.|\:|\'| |\"|\&amp;|\#|\[|\]|~/g, "-");
            str = str.replace(/-+-/g, "-"); //thay thế 2- thành 1-
            str = str.replace(/^\-+|\-+$/g, "");//cắt bỏ ký tự - ở đầu và cuối chuỗi
            str = str.replace(/[^a-zA-Z0-9]+/g, '-');
            $("#id_slug").val(str);
        });

        CKEDITOR.replace('editor1');
    </script>
{% endblock %}
